[16:39:26] INFO: 日志已清空
[16:39:36] INFO: 开始执行事件: EVT_0030
[16:39:36] INFO: 📋 事件详情: LCA产量损失
[16:39:36] INFO:    事件类型: LCA产量损失
[16:39:36] INFO:    选择影响日期: 2025-03-01
[16:39:36] INFO:    选择影响班次: T4
[16:39:36] INFO:    选择产线: F25
[16:39:36] INFO:    确认产品PN: 200723400
[16:39:36] INFO:    已经损失的产量: 1000
[16:39:36] INFO:    剩余修理时间: 3
[16:39:36] INFO:    _shift_forecast_calculation: {'status': 'success', 'message': '本班预测产量计算完成: 1400.00', 'E': 3300.0, 'C': 1000.0, 'D': 3.0, 'F': 1400.0, 'capacity_loss_per_hour': 300.0, 'total_capacity_loss': 900.0, 'date': '2025-03-01', 'shift': 'T4'}
[16:39:36] INFO: 🚀 开始执行LCA产量损失处理逻辑...
[16:39:36] INFO: ============================================================
[16:39:36] INFO: 🚀 开始处理LCA产能损失事件
[16:39:36] INFO: 当前事件信息: 日期=2025-03-01, 班次=T4, 产线=F25
[16:39:36] INFO: 📊 步骤0: 计算本班预测产量 I...
[16:39:36] INFO: 找到目标产线 F25 在行 39
[16:39:36] INFO: 找到 F25 关联的forecast值: 3300
[16:39:36] INFO: ✅ 本班预测产量计算成功:
[16:39:36] INFO:    📈 E (本班出货计划): 3300.0
[16:39:36] INFO:    📉 C (已损失产量): 1000.0
[16:39:36] INFO:    ⏱️ D (剩余修理时间): 3.0小时
[16:39:36] INFO:    🧮 计算公式: F = E - C - D*(E/11)
[16:39:36] INFO:    🎯 F (本班预测产量 I): 1400.00
[16:39:36] INFO:    ⚡ 每小时产能损失: 300.00
[16:39:36] INFO:    📊 总产能损失: 900.00
[16:39:36] INFO: 🔍 步骤1: 开始检查前3个班次的损失情况...
[16:39:36] INFO: 检查前3个班次的损失情况...
[16:39:36] INFO: 成功加载带班次信息的Daily Plan: (307, 18)
[16:39:36] INFO: 成功加载带班次信息的Daily Plan: (307, 18)
[16:39:36] INFO: 提取到 14 个可用班次
[16:39:36] INFO: 可用班次示例:
[16:39:36] INFO:   2025-03-01 T4 (Fri)
[16:39:36] INFO:   2025-03-02 T2 (Sat)
[16:39:36] INFO:   2025-03-02 T4 (Sat)
[16:39:36] INFO:   2025-03-03 T1 (Sun)
[16:39:36] INFO:   2025-03-03 T3 (Sun)
[16:39:36] INFO: 📊 从Daily Plan提取到 14 个可用班次
[16:39:36] INFO: 找到当前班次位置: 索引 0
[16:39:36] INFO: 无法找到第1个前置班次（索引超出范围）
[16:39:36] INFO: 无法找到第2个前置班次（索引超出范围）
[16:39:36] INFO: 无法找到第3个前置班次（索引超出范围）
[16:39:36] INFO: 📅 计算得出前3个班次:
[16:39:36] INFO: 🔍 开始查询各班次的损失数据...
[16:39:36] INFO: 检查结果: 前3个班次中部分没有损失报告，且累计损失0未超过10K
[16:39:36] INFO: 📋 检查结果统计:
[16:39:36] INFO:    - 检查班次数: 0
[16:39:36] INFO:    - 有损失班次: 0
[16:39:36] INFO:    - 累计损失: 0
[16:39:36] INFO:    - 所有班次都有损失: False
[16:39:36] INFO:    - 损失超过10K: False
[16:39:36] INFO: ℹ️ 判定结果: 未达到加线条件，继续计算DOS
[16:39:36] INFO: 📝 原因: 前3个班次中部分没有损失报告，且累计损失0未超过10K
[16:39:36] INFO: 🧮 步骤2: 计算预测损失后新DOS...
[16:39:36] INFO: 找到目标产线 F25 在行 39
[16:39:36] INFO: 找到 F25 的数值: 2196
[16:39:36] INFO: DOS计算参数:
[16:39:36] INFO:    PN: 200723400
[16:39:36] INFO:    产线: F25
[16:39:36] INFO:    当前班次: 2025-03-01 T4
[16:39:36] INFO: 成功加载FG EOH数据: (177, 7)
[16:39:36] INFO: 列名: ['Product', 'Head_Qty', 'P/N', 'WHFH', 'WHFP', 'WHFR', 'TTL QTY']
[16:39:36] INFO: 📎 计算PN 200723400 的G值: 3127
[16:39:36] INFO:    🏷️ Product: EvansBP, Head_Qty: 16.0
[16:39:36] INFO:    🔢 组内PN数量: 9
[16:39:36] INFO: 成功加载带班次信息的Daily Plan: (307, 18)
[16:39:36] INFO: 提取到 14 个可用班次
[16:39:36] INFO: 可用班次示例:
[16:39:36] INFO:   2025-03-01 T4 (Fri)
[16:39:36] INFO:   2025-03-02 T2 (Sat)
[16:39:36] INFO:   2025-03-02 T4 (Sat)
[16:39:36] INFO:   2025-03-03 T1 (Sun)
[16:39:36] INFO:   2025-03-03 T3 (Sun)
[16:39:36] INFO: 找到当前班次位置: 索引 0
[16:39:36] INFO: 找到目标产线 F25 在行 39
[16:39:36] INFO: 找到 F25 的数值: 1296
[16:39:36] INFO:    下第1个班次 2025-03-02 T2: 1296.0
[16:39:36] INFO: 找到目标产线 F25 在行 39
[16:39:36] INFO: F25 在 2025-03-02 T4 班次无数值，返回0
[16:39:36] INFO:    下第2个班次 2025-03-02 T4: 0.0
[16:39:36] INFO: 🔢 只有一个班次有有效出货计划，将其乘以2: 1296.0 * 2 = 2592.0
[16:39:36] INFO: 🧮 DOS计算公式: (G+F-H)/I
[16:39:36] INFO:    📎 G (上一个班的合计EOH): 3127.0
[16:39:36] INFO:    🎯 F (本班预计产量): 1400.0
[16:39:36] INFO:    📈 H (本班安排产量): 2196.0
[16:39:36] INFO:    📅 I (下两个班次出货计划): 2592.0
[16:39:36] INFO:    📊 计算过程: (3127.0 + 1400.0 - 2196.0) / 2592.0
[16:39:36] INFO:    🆕 预测损失后新DOS: 0.90 天
[16:39:36] INFO: ============================================================
[16:39:36] INFO: ==================================================
[16:39:36] INFO: 📊 LCA处理结果总结:
[16:39:36] INFO: ℹ️  损失在正常范围内，已计算DOS
[16:39:36] INFO: 🆕 预测损失后新DOS: 0.90 天
[16:39:36] INFO: ✅ 最终建议: 标准处理
[16:39:36] INFO: ==================================================

