# LCA产能损失-临时加产能流程

## 概述
本文档描述LCA产能损失事件的临时加产能处理流程。该流程用于快速评估和处理生产线产能损失，通过临时加线或调整DOS（Days of Supply）来补偿产能缺口。

## 流程图

```mermaid
flowchart TD
    A[Start] --> B{检查有没有LCA产能损失报告}
    
    B -->|NO| C[End]
    B -->|Yes| D{前3个班次新有报告损失，且预计损失超过10K?}
    
    D -->|Yes| E[要求加线<br/>输出"产线状况不佳，考虑加线"]
    D -->|NO| F[预测损失后新DOS]
    
    F --> G[确认DOS控制量]
    
    E --> H[流程结束 - 加线处理]
    G --> I[流程结束 - DOS调整]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style C fill:#ccc,stroke:#333,stroke-width:2px
    style H fill:#9f9,stroke:#333,stroke-width:2px
    style I fill:#9f9,stroke:#333,stroke-width:2px
```

## 核心计算方法

### 1. 本班预测产量计算方法

#### 输入数据：
- **E**: 读取表AP的参数"forecast"
- **C**: 已经损失的产量 (用户输入)
- **D**: 剩余修理时间 (用户输入)

#### 计算公式：
```
本班预计产量 F = E - C - D * (E/11)
```

#### 损失率计算：
- 比如损失4小时，那么就是损失了总的能力的4/11
- 损失x小时就是损失了总能力的2/11，即 `(x/11)` 的损失率

### 2. 预测损失后新DOS计算方法

#### 需要数据：
- **G**: 上一个班的合计EOH(库存) - 读取表B
- **F**: 本班预计产量 (从上面计算得出)
- **H**: 本班出货计划 - 读取表A
- **I**: 下两个班次的出货计划 - 读取表A

#### 计算公式：
```
本班预计的EOH = G + F - H
预测损失后新DOS计算公式 = (G + F - H) / I
```

## 处理逻辑详解

### 第一步：LCA报告检查
1. **检查条件**: 系统检查是否存在LCA产能损失报告
2. **处理**: 
   - 如果没有报告 → 流程结束
   - 如果有报告 → 继续下一步

### 第二步：损失影响评估
1. **评估条件**: 前3个班次新有报告损失，且预计损失超过10K
2. **判断逻辑**:
   - **超过10K**: 产能损失严重，需要加线补偿
   - **不超过10K**: 产能损失可控，通过DOS调整处理

### 第三步：处理方案执行

#### 方案A：加线处理 (损失 > 10K)
- **触发条件**: 预计损失超过10K
- **处理动作**: 
  - 输出警告信息："产线状况不佳，考虑加线"
  - 启动加线流程（转入加线模块）
  - 通知相关人员进行人工干预

#### 方案B：DOS调整 (损失 ≤ 10K)
- **触发条件**: 预计损失在10K以内
- **处理动作**:
  1. 计算预测损失后的新DOS
  2. 确认DOS控制量是否在可接受范围
  3. 更新库存和出货计划
  4. 生成调整报告

## 数据源说明

### 输入数据表
- **表A**: 出货计划表 (包含本班和下两班的出货计划)
- **表B**: 库存表 (EOH - End of Hand库存数据)
- **表AP**: 预测参数表 (包含forecast参数)

### 输出数据
- **调整后的DOS值**
- **产能损失报告**
- **建议处理方案**

## 关键阈值参数

### 系统配置参数
- **损失阈值**: 10K (可配置)
- **监控窗口**: 前3个班次
- **DOS控制范围**: 0.5个班次默认值 (可通过用户需求调整)

### 计算参数
- **班次总时长**: 11小时 (用于损失率计算)
- **预测精度**: forecast参数来源于AP表

## 异常处理

### 数据异常
- **缺失数据**: 如果关键数据表缺失，系统提示错误并终止流程
- **数据格式错误**: 自动尝试数据清洗，失败则人工干预
- **超出范围值**: 系统警告并使用默认值

### 业务异常
- **连续损失**: 如果连续多个班次出现损失，自动升级处理优先级
- **极端损失**: 如果单次损失超过50K，立即触发紧急处理流程

## 流程优化建议

### 自动化改进
- 定时自动检查LCA报告
- 自动数据获取和计算
- 智能阈值调整

### 决策支持
- 历史数据分析
- 损失趋势预测
- 成本效益分析

## 版本历史
- v1.0: 初始版本 - 基础LCA产能损失处理逻辑
- 待完善: 与加线模块的集成接口